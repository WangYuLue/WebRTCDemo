<div id="container">
</div>
<script src="../js/simplepeer.min.js"></script>
<script src="../js/socket.io.js"></script>
<script>
    let socket = io('http://localhost:8999');
    let Peer = SimplePeer ;
    let Peers = {};
    let remote_local = {}; //本地Peer和远程SocketIO的一一对照
    
    socket.on("hello",function(data){
        console.log(data);
    })

    socket.emit("manager_start")

    socket.on("manager_recive_reply",function(data){
        console.log('manager_recive_reply',data);
        createPeer(data);
    })

    socket.on("signal",function(data){
        Peers[remote_local[data.from_socket_id]].signal(data.data);
    })

    function createPeer(data) {
        let peer = new Peer() ;
        Peers[peer._id] = peer;
        remote_local[data.interviewer_socket_id] = peer._id;
        Peers[peer._id].on('signal', function (d) {
            socket.emit("signal", {
                to_socket_id : data.interviewer_socket_id,
                data : d
            });
        })
        Peers[peer._id].on('stream', function (stream) {
            console.log("得到远程视频流............")
            let video = document.createElement('video');
            video.srcObject = stream;
            document.getElementById('container').appendChild(video);
            video.play()
        })
    }
</script>